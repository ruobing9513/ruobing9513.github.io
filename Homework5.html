<!DOCTYPE html>
<html>
<title>U.S. Mass Shooting data</title>
<meta charset="UTF-8">
	<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
	<style type="text/css">
			body {
				margin:0;
			}
			#h {
				font-family: Optima, sans-serif;
				text-align: center;
				font-size:40px;
			}

			#p {
				font-family: Optima, sans-serif;
				float: left;
  				margin-left: 300px;
				margin-right: 280px;
				text-align: left;
				font-size: 20px;
			}
			#viz{
			align-items: center;
		}
		</style>

	<body id="mybody">
	<h1 id="h">U.S. major mass shooting </h1>
	<p id="p">One strict definition used in the past by the federal government says at least four victims must be killed. Much broader criteria requires at least four victims be injured, though not necessarily killed. Other definitions land somewhere in the middle. The visualization below shows all the shooting incidents that fall in the criteria from 2016 to 2018.</p>
	<br>

	<script>
		d3.csv("Massshooting.csv", function(error,data){
			if (error){
			console.log("Error!"); 
			}     
			else {
			console.log(data);
			console.log("CSV string");  
			data.forEach(function(d){
				d.Fatalities = parseFloat(d.Fatalities) 
				d. Injured = parseFloat(d.Injured)// make the object/string to numbers 
			})
			}
		});

    var weapon = d3.csv("weapon.csv", function(error,data){
      if (error){
      console.log("Error!"); 
      }     
      else {
      console.log(data);
      console.log("CSV string");  
      data.forEach(function(d){
        d.Cases = parseFloat(d.Cases),
        d.Amount = parseFloat (d.Amount)
         // make the object/string to numbers 
       })
      }
    });

    var diameter = 400;

    var color = d3.scaleOrdinal(d3.schemeCategory20);

	var bubble = d3.pack(weapon)
            .size([diameter, diameter])
            .padding(1.5);

    var svg = d3.select("body")
            .append("svg")
            .attr("width", diameter)
            .attr("height", diameter)
            .attr("class", "bubble");

    var nodes = d3.hierarchy(weapon)
            .sum(function(d) { return d.Cases; });

    var node = svg.selectAll("body")
            .data(bubble(nodes).descendants())
            .enter()
            .filter(function(d){
                return  !d.children
            })
            .append("g")
            .attr("class", "node")
            .attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });

    node.append("title")
            .text(function(d) {
                return d.Name + ": " + d.Cases;
            });

    node.append("circle")
            .attr("r", function(d) {
                return d.r;
            })
            .style("fill", function(d,i) {
                return color(i);
            });
    node.append("text")
            .attr("dy", ".2em")
            .style("text-anchor", "middle")
            .text(function(d) {
                return d.data.Name.substring(0, d.r / 3);
            })
            .attr("font-family", "Futura")
            .attr("font-size", function(d){
                return d.r/5;
            })
            .attr("fill", "white");

        node.append("text")
            .attr("dy", "1.3em")
            .style("text-anchor", "middle")
            .text(function(d) {
                return d.data.Cases;
            })
            .attr("font-family",  "Gill Sans", "Gill Sans MT")
            .attr("font-size", function(d){
                return d.r/5;
            })
            .attr("fill", "white");

        d3.select(self.frameElement)
            .style("height", diameter + "px");
	</script>

</html>
