<!DOCTYPE html>
<html>
<title>Explore U.S. Mass Shooting - More guns,more violence?</title>
<meta charset="UTF-8">
	<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
	<link href= "animate.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Anton|PT+Sans+Narrow" rel="stylesheet">
	<style type="text/css">
			#mybody{
				background-color: white;
			}

			.text{
				position: absolute;
			    bottom: 100px;
			    right: 20px;
			    font-family: Anton,PT Sans Narrow, sans-serif;
			   	font-size: 40px;
			    color: white;
			    padding-left: 20px;
			    padding-right: 20px;
			}

			#h3{
				font-family: PT Sans Narrow, sans-serif;
				text-align: center;
				font-weight: bold;
				font-size:40px;
				color: black;

			}

			#h4 {
				font-family: PT Sans Narrow, sans-serif;
				text-align: center;
				font-weight: bold;
				font-size:30px;
				color: black;
			}

			#byline{
				font-family: PT Sans Narrow, sans-serif;
				text-align: right;
				font-size:15px;
				color: white;
				position: absolute;
 				top: 75%;
  				left: 75%;
			}

			#source{
				font-family: Optima, sans-serif;
				text-align: center;
				font-size: 15px;
				font-style: italic;
			}

			#p {
				font-family: Optima, sans-serif;
				float: left;
  				margin-left: 200px;
				margin-right: 200px;
				text-align: left;
				font-size: 18px;
			}
			#n1{
				font-family: Optima, sans-serif;
				color: darkred;
				font-weight: bold;
			}

			#coverpage{
				width:100%;
			}

			.container{
				text-align: center;
				animation-duration: 2s;
			}

			#tooltip{
				position: absolute;           
			  	text-align: center;           
			  	width: 60px;                  
			 	height: 28px;                 
			  	padding: 2px;             
			  	font: 12px sans-serif;        
			  	background: lightsteelblue;   
			  	border: 0px;                
			  	pointer-events: none;         
			}

			.arc text {
			  font-family: Optima, sans-serif;
			  font-size: 20px;
			  text-anchor: middle;
			}

			#transition {
				font-family: Anton, sans-serif;
				text-align: center;
				font-size:40px;
				color: white;
				position: absolute;
				margin-left: 400px;
				margin-right: 400px;
				margin-top: 450px;
			}

			#transitiontext{
				text-align: center;
				animation-duration: 3s;
			}

			#subhead {
				font-family: PT Sans Narrow, sans-serif;
				text-align: left;
				font-size:30px;
				color: black;
				margin-left: 200px;
				margin-right: 300px;
			}

			.axis text {
			  font: 10px sans-serif;
			}

			.axis line, .axis path {
			  fill: none;
			  stroke: #000;
			  shape-rendering: crispEdges;
			}

			svg{
			  padding-left: 50px;
			}

			.caption{
				font-family:Optima,sans-serif;
				font-size:18px;
				padding-bottom: 10%;
			}

			#weaponsection{
				margin-left: 200px;
				width: 400px;

			}

			button{
				background: white;
				font-family: "Optima","Noto Sans", Sans-serif;
				color:darkslategray;
				border:black;
				text-align: center;
				font-size:15px;
				display:inline-block;
				padding:10px 15px;
				-webkit-transition-duration: 0.4s; /* Safari */
		    			transition-duration: 0.4s;
			}

			button:hover {
	    		background-color: grey; 
	    		color: white;
			}

			#viz{
				align-items: center;
				margin-left: 200px;

			}
		</style>

<body id="mybody">
	<div class="container" class="item animated fadeIn";>
		<img src="finalintro.png" id="coverpage">
		<div class="text" class="item animated fadeIn";>
			<h1 id="h1">More Guns, More Violence?</h1>
			<p style="size:20px">By Ruobing Su</p>
		</div>
	</div>
</body>

	<head>
		<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://unpkg.com/topojson@3"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.24.0/d3-legend.js"></script>
	</head>

	<body>
		<div>
		<h2 id="h3">U.S. Major Mass Shooting since 1982</h2>
		<p id="p">The deadly school shooting in Parkland in Feburary, has ignited national outrage and calls for action on gun reform. Since 1982, there have been <span id="n1">at least 98 </span> public mass shootings across the country, with the killings unfolding in 34 states from Massachusetts to Hawaii; <span id="n1">fifty-nine</span> of these mass shootings have occurred since 2006.
		<br><br>Although, the definition of mass shooting varies place to place, according to FBI, <span id="n1">a wide range of gun crimes in which four or more people have been either wounded or killed can </span> be called as mass shooting. 
		<br><br>The following data on U.S. major mass shooting since 1982 is collected by Mother Jones, a progressive American magazine. The data set has excluded shootings stemming from more conventional crimes such as armed robbery or gang violence. </p>
		<p id="source">Data source: Mother Jones</p>
		</div>
		<div align="center">
			<svg id="map" width="1000" height="550" align="center">
				<rect width=1000 height=550 fill="" opacity="0" align="center"></rect>
			</svg>
		</div>

	</body>
	<div>
	<script type="text/javascript">
		d3.queue()
			.defer(d3.json, "usa.json")
			.defer(d3.csv, "Massshooting.csv")
			.defer(d3.csv, "gunownership.csv")
			.defer(d3.csv, "weapons.csv")
			.awaitAll(function(error,dataArray){
				var data = dataArray[0];
				var shooting = dataArray[1];
				var ownership = dataArray [2];
				var weapons = dataArray [3];
				ownership.forEach(function(state){
					state.gunownership = parseFloat(state.gunownership);
					});
				weapons.forEach(function(weapon){
					weapon.cases = parseFloat(weapon.cases)
				});
				weapons.forEach(function(weapon){
					weapon.numbers = parseFloat(weapon.numbers)
				});
				console.log(dataArray);

			var dataExtent = d3.extent(ownership, function(d){
						return d.gunownership;
					})
			console.log(dataExtent);

			var colorScale = d3.scaleLinear()
				.domain(dataExtent)
				.range(["#f9f9f9","#922B21"]);

//printing the map 
			var geoJSON = topojson.feature(data,data.objects.states);
			
			var proj = d3.geoAlbersUsa()
				.fitSize([1000,550],geoJSON); 

			var path = d3.geoPath()
			.projection(proj); 

			var states = d3.select("#map").selectAll("path")
				.data(geoJSON.features);

			var div = d3.select("body")
				.append("div")
				.attr("id","tooltip")
				.style("opacity", 0)

			//passing the path to svg and setting up the "d" value to draw a path 
			states.enter().append("path") 
					.attr("fill", function(feature){

						var stateData = ownership.filter(function(d){
							return d.id == feature.id
						})
						if (stateData.length == 0) {
							return "grey";
						}
						var number = stateData[0].gunownership;
						return colorScale(number);
					})
					.attr("stroke","white")
					.attr("stroke-width",1.5)
					.attr("d",function(feature){
						return path(feature);
					});


			//load my data into the file, make sure you create a new data array and variable accordingly
			
			var dots = d3.select("#map").selectAll("circle")
			.data(shooting);


			dots.enter().append("circle")
				.attr("transform",function(point){
					return "translate(" + proj([point.longitude,point.latitude]) + ")"
				})
				.attr("fill","black") //if you want to use data in csv, make sure have point.before the column name 
				.attr("stroke-width",.5)
				
				.attr("r", function(point){
					return point.Fatalities/1.2;
				})
				.attr("opacity",0.8)
					//mouseover event

				.on("mouseover", function(d) {
			    d3.select(this)
			      .classed("mouseover", true)
			      .attr("r", function(point){
					return point.Fatalities/1.2;
				})
			      .attr("class", "hoveredpoints")
			      .attr("fill","#2F4F4F")
			      
			    div.text(d.Cases)
			     
				})
		    		
			 	.on("mouseout", function(d) {
			    d3.select(this)
			      .attr("r", function(point){
					return point.Fatalities/1.2 ;
					})
			      .attr("fill", "black")
			      .attr("class", "points")
			      .attr("opacity",0.75)
			      .classed("mouseover", false)

			  });
			 	
			});
	</script>
	</div>

	 <div id="legend1"></div>
	<script type="text/javascript">
			    var w = 200, h = 50;

			    var key = d3.select("#legend1")
			      .append("svg")
			      .attr("width", w)
			      .attr("height", h);

			    var legend = key.append("defs")
			      .append("svg:linearGradient")
			      .attr("id", "gradient")
			      .attr("x1", "0")
			      .attr("y1", "100%")
			      .attr("x2", "100%")
			      .attr("y2", "100%")
			      .attr("spreadMethod", "pad");

			    legend.append("stop")
			      .attr("offset", "0%")
			      .attr("stop-color", "#f9f9f9")
			      .attr("stop-opacity", 1);

			    legend.append("stop")
			      .attr("offset", "100%")
			      .attr("stop-color", "#922B21")
			      .attr("stop-opacity", 1);

			    key.append("rect")
			      .attr("width", w)
			      .attr("height", h - 30)
			      .style("fill", "url(#gradient)")
			      .attr("transform", "translate(10,10)");

			    var y = d3.scaleLinear()
			      .range([200, 0])
			      .domain([61.7, 5.2]);

			    var yAxis = d3.axisBottom()
			      .scale(y)
			      .ticks (2);

			    key.append("g")
			      .attr("class", "y axis")
			      .attr("transform", "translate(10,30)")
			      .call(yAxis)
			      .append("text")
			      .attr("transform", "rotate(-90)")
			      .attr("y", 0)
			      .attr("dy", ".71em")
			      .style("text-anchor", "end")
			      .text("Percetage of legal gun ownership by state");
	</script>
	
	<div id="transitiontext" class="item animated fadeIn">
		<h1 id="transition">The U.S. makes up less than 5% of the world population, but holds 31% of global mass shooters.</h1>
		<img src="transition1.png" id="coverpage">
		
	</div>

	<div>
		<h4 id="subhead">The numbers are staggering: U.S. has the most public mass shooters in the world, study shows.</h4>
		<p id="p">Among 97 cases that have been recorded by Mother Jones, all the mass shooting happened in public. Among which, working place is where a great amount of mass shooting happened; secondly schools and millitary; streets, restaurants, airports, public parties, clubs and other places are included as "others." 
		<br>Adam Lankford of University of Alabama studied mass shootings in 171 countries from the years 1966-2012 and found that the United States has the most public mass shooters and more than 240 million more guns than the second highest country, India.</p>
	</div>

	<div>
	<script type="text/javascript">
		//pie chart of venue 	
		var data = [16, 28, 5, 44];

		var width = 960,
		    height = 500,
		    radius = Math.min(width, height) / 2;

		var color = d3.scaleOrdinal()
		    .range(["#F2D7D5", "#D98880", "#C0392B", "#641E16"]);

		var arc = d3.arc()
		    .outerRadius(radius - 10)
		    .innerRadius(0);

		var labelArc = d3.arc()
		    .outerRadius(radius - 40)
		    .innerRadius(radius - 40);

		var pie = d3.pie()
		    .sort(null)
		    .value(function(d) { return d; });

		var svg = d3.select("body").append("svg")
		    .attr("width", width)
		    .attr("height", height)
		  	.append("g")
		    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		  var g = svg.selectAll(".arc")
		      .data(pie(data))
		    .enter().append("g")
		      .attr("class", "arc");

		  g.append("path")
		      .attr("d", arc)
		      .style("fill", function(d) { return color(d.data); });

		  g.append("text")
		      .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
		      .attr("dy", ".35em")
		      .text(function(d) { return d.data; });

		  //legend 
			 	var g = svg.append("g")
				 	.attr("class", "legendThreshold")
	    			.attr("transform", "translate(300,-10)");
	    		g.append("text")
	    			.attr("class","caption")
	    			.attr("x",0)
	    			.attr("y",-6)
	    			.text("Legend");
	    		var labels = ["Schools","Public","Others","Workplace"] 
	    		var legend = d3.legendColor()
	    			.labels(function (d) { return labels[d.i]; })
				    .shapePadding(4)
				    .scale(color);
				svg.select(".legendThreshold")
				    .call(legend);
			</script>
		</div>

	<div>
		<h4 id="subhead">Why AR-15 keeps appearing in U.S. mass shootings? It is too easy to purchase guns without background check.</h4>
		<p id="p"> AR-15-style rifles have increasingly appeared in American mass shootings, including the deadliest high school shooting in the nation's history at Marjory Stoneman Douglas High School in Parkland, Florida. 
		<br>
		The chart below shows the most frequent weapons being used in the major mass shooting cases from 1982 up to date. </p>
	</div>

	<svg id=viz width="800" height="200" align="center" ></svg>

	<div align="middle";>
			<button id = "click1" onclick = "bars(numberofweapon)">Number of weapons in mass shooting cases</button>
			<button id = "click2" onclick = "bars(numberofcases)">Number of cases the weapons are being used</button>
	</div>

	<script type="text/javascript">
		var numberofweapon = [46,100,30,23,1];
		var numberofcases = [38,68,24,18,1];

		var height = 20;

		var bars = function(dataArray){
			var svg = d3.select("#viz");

				var dots = svg.selectAll(".rect")
					.data(dataArray);
	
				dots.enter().append("rect")
					.attr("class","rect")

					.attr("width",0)
					.attr("height",height)
					.attr("x", "0")
					.attr("y", function(d,index){
						return index * height * 1.2 + 20 ;
					})
					.attr("fill", "black")

					.transition()
					.duration (1000)
					

					.attr("width", function(d,i){
						return(d*5)
					})
					.attr("height",height)
					.attr("fill", "black")
					.attr("x","0")
					.attr("y", function(d,index){
						return index * height * 1.2 + 20 ;
					})

					.attr("fill", "#C0392B");					
				
				dots
					.transition()
			
					.duration(1000)
					.attr("width", function(d,i){
						return(d*5)
					})
					.attr("height",height)
					.attr("fill", "#641E16");
				
				dots.exit()
					.transition()
					.duration(1000)
					.attr("width",0)
					.attr("height",height)
					.remove();

				};

		bars(numberofweapon)

	</script>

	


</html>
